var serverModule = require("./Server"),
    http = require('http');

(function () {

    function initAgent(name, params) {
        return {
            "module"    : require("./agents/" + name + ".js"),
            "class"     : name,
            "params"    : params
        };
    };

    var mapModule = require("./Map");
    var map = new mapModule.Map();

    map.setSize(50, 50);
    map.map = [
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,3,3,4,3,3,3,3,3,3,3,3,3,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,0,3,3,3,3,3,3,3,3,3,3,0],
        [0,0,0,3,3,3,3,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,0],
        [0,0,0,3,3,3,3,3,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,3,4,4,3,0],
        [0,0,3,3,3,3,3,4,4,4,4,3,3,3,3,3,2,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,2,2,2,3,3,3,3,3,3,4,4,3,3,0],
        [0,0,3,2,2,3,4,4,4,4,4,4,3,3,2,2,2,2,3,3,3,3,3,3,3,4,4,4,4,4,0,0,4,4,4,4,4,4,2,2,2,3,3,2,2,4,3,3,3,0],
        [0,0,2,2,2,2,4,4,5,4,4,4,2,2,2,2,2,2,2,2,3,3,2,2,3,4,4,4,4,0,0,0,0,4,4,4,4,4,2,2,2,2,2,2,2,4,3,3,3,0],
        [0,2,2,2,2,2,4,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,0,0,4,4,4,4,2,2,2,2,2,2,2,2,4,4,4,3,3,0],
        [0,2,2,2,2,2,2,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4,4,4,4,4,4,4,4,2,2,2,2,2,2,2,2,2,4,4,4,4,3,0],
        [0,1,2,2,2,2,2,1,1,1,1,1,1,2,2,2,2,2,1,2,1,1,2,2,2,2,1,4,4,4,4,4,4,4,1,1,1,1,2,2,2,2,1,2,2,4,4,2,2,0],
        [0,1,1,2,1,5,1,1,1,1,1,5,1,1,1,2,2,1,1,1,1,1,1,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,1,1,1,1,1,2,2,2,0],
        [0,1,1,1,1,5,5,1,1,1,5,5,5,5,1,1,1,1,1,5,1,1,1,1,1,1,5,5,1,1,1,1,5,5,5,1,1,1,1,1,1,1,1,5,1,1,1,2,2,0],
        [0,1,1,1,1,1,5,5,1,1,1,5,5,5,1,1,1,1,1,5,1,1,1,1,1,1,1,5,5,1,1,5,5,1,5,5,1,1,1,1,1,1,5,5,5,1,1,1,0,0],
        [0,4,1,1,1,1,1,5,5,1,1,1,5,1,1,5,1,1,1,5,5,1,1,5,1,1,1,1,5,5,5,5,5,1,1,5,1,4,4,1,1,1,1,5,5,1,1,1,0,0],
        [0,4,4,1,1,1,1,1,5,5,1,1,1,1,5,5,1,1,1,5,5,1,5,5,5,1,1,5,5,5,5,1,1,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,0,0],
        [0,4,4,4,1,1,1,1,5,5,5,1,1,1,5,1,1,1,1,1,5,5,5,5,1,1,1,5,1,1,1,1,1,1,1,1,1,1,1,5,5,1,1,1,1,1,1,1,1,0],
        [0,4,4,4,4,4,1,1,1,5,5,5,1,5,5,1,1,1,5,5,1,1,5,5,1,1,1,5,1,1,1,1,1,1,1,4,4,1,1,5,5,1,1,5,5,1,1,1,1,0],
        [0,0,4,1,1,4,4,1,1,5,1,5,5,5,1,1,5,1,5,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,4,1,1,1,1,1,5,5,5,1,1,1,1,0],
        [0,0,4,1,1,1,1,1,5,5,1,1,1,5,5,1,5,5,1,1,1,1,5,1,1,2,2,2,4,4,4,4,1,5,5,5,1,1,1,1,1,5,5,5,5,1,1,4,4,0],
        [0,0,1,1,5,5,1,1,1,1,1,1,1,1,5,1,1,5,1,1,1,5,5,1,4,4,4,4,4,2,2,1,1,5,5,5,5,1,1,1,5,5,5,5,5,4,4,4,1,0],
        [0,0,1,1,5,5,1,1,4,5,5,1,5,5,1,1,1,5,5,1,5,5,5,4,4,4,4,2,2,2,1,1,1,1,5,5,5,1,5,5,5,5,5,4,4,4,1,1,1,0],
        [0,0,1,1,5,1,1,4,4,5,5,5,5,1,1,1,5,5,5,1,5,5,4,4,4,4,2,2,2,1,1,1,1,1,1,5,1,5,5,5,4,4,4,4,1,1,1,1,0,0],
        [0,1,1,1,1,1,4,4,4,5,5,1,1,1,5,5,5,5,1,5,5,4,4,4,4,2,2,2,1,1,1,1,5,5,1,1,1,1,1,4,4,1,1,1,1,5,1,0,0,0],
        [0,1,1,1,1,1,4,4,1,1,1,1,5,5,5,5,5,1,1,1,4,4,4,4,2,2,2,1,1,1,5,5,5,5,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0],
        [0,1,1,4,4,4,4,1,1,1,5,5,1,1,1,1,1,1,1,4,4,4,4,4,2,2,1,1,5,5,5,1,5,5,5,1,1,1,1,5,5,5,5,1,5,1,1,0,0,0],
        [0,4,4,4,4,4,1,1,1,1,1,1,5,1,1,5,5,1,1,4,4,4,4,2,2,1,1,5,5,1,1,1,1,5,5,5,1,5,5,5,5,5,5,5,1,1,1,1,0,0],
        [0,0,4,1,1,1,1,1,1,1,1,5,5,5,1,1,5,5,1,4,4,4,1,1,1,1,1,1,1,1,1,1,5,1,5,5,1,5,5,5,5,5,5,5,5,1,1,1,0,0],
        [0,0,0,0,1,1,5,1,5,5,1,5,5,5,5,1,1,1,1,1,4,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,5,5,5,1,5,5,5,1,1,1,1,0],
        [0,0,1,1,1,5,5,1,1,1,5,5,5,5,5,1,1,1,1,1,1,1,1,1,5,5,1,1,5,5,1,1,1,1,1,1,1,5,5,1,1,4,1,5,5,5,1,1,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,5,5,5,1,1,1,1,1,1,1,1,1,1,5,1,1,5,5,5,5,1,1,1,1,1,1,1,1,1,5,1,5,5,5,1,5,1,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,5,1,1,1,1,1,1,4,4,1,1,5,5,1,1,5,5,5,1,1,1,5,5,5,1,1,1,5,5,5,5,5,1,5,5,1,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,1,5,1,1,1,5,5,1,1,1,1,1,5,5,1,1,5,5,5,5,5,1,5,1,1,1,0,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,1,1,5,1,1,1,1,1,1,1,1,1,1,1,1,1,5,5,5,1,1,1,1,5,1,1,1,1,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,4,4,1,1,1,1,4,1,1,1,1,1,5,5,5,1,1,1,1,4,0],
        [0,0,1,1,1,1,4,4,1,1,1,1,1,1,2,2,2,4,4,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,4,4,2,1,1,1,5,5,5,1,1,1,4,4,4,0],
        [0,0,0,1,1,4,4,1,1,1,4,2,2,2,2,2,2,2,4,4,4,2,2,1,1,1,1,1,1,1,4,4,1,4,4,2,2,1,1,1,5,5,5,1,1,4,4,4,2,0],
        [0,0,0,2,4,4,1,1,5,1,4,2,2,2,2,2,2,2,2,4,4,4,2,2,2,2,1,1,1,1,1,4,4,4,2,2,2,1,1,1,1,1,1,1,4,4,4,2,0,0],
        [0,0,2,2,4,4,1,5,5,1,4,4,2,2,2,2,2,2,4,4,4,3,2,2,2,2,2,2,2,1,1,4,4,2,2,2,2,2,2,1,1,1,4,4,4,2,2,2,0,0],
        [0,0,2,2,4,4,1,1,1,4,4,2,2,2,2,2,2,2,4,4,3,2,2,2,2,2,2,2,2,2,2,4,4,2,2,2,2,2,2,2,1,1,4,2,2,2,2,2,0,0],
        [0,2,2,2,2,4,4,1,4,4,4,2,2,2,2,2,2,2,4,4,4,2,2,2,2,2,2,2,2,2,2,2,4,4,2,2,2,2,2,2,2,4,4,2,2,2,2,2,2,0],
        [0,2,2,2,2,4,4,4,4,4,2,2,2,2,2,2,2,2,2,4,4,2,2,2,2,2,2,2,2,2,2,2,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0],
        [0,2,2,2,2,2,4,4,4,2,2,2,2,2,2,2,2,2,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,4,4,3,2,2,2,2,2,2,2,2,2,2,2,2,2,0],
        [0,0,2,2,2,2,2,2,3,3,2,2,2,2,2,2,3,4,4,4,4,3,2,2,2,2,2,2,2,2,2,2,2,4,4,3,3,2,2,2,2,2,2,2,2,2,2,2,0,0],
        [0,0,2,2,2,2,2,3,3,3,3,2,2,2,3,3,3,4,4,4,3,3,3,2,2,2,2,2,2,2,2,2,2,3,4,4,3,3,3,2,2,2,2,2,2,2,3,2,0,0],
        [0,3,3,2,2,2,3,3,3,3,3,3,3,3,3,3,3,4,4,4,3,3,3,3,3,3,3,3,2,2,2,2,3,3,3,4,4,3,3,3,2,2,2,2,3,3,3,2,0,0],
        [0,3,3,3,2,2,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,3,3,3,3,3,3,3,2,3,3,3,3,3,4,4,3,3,3,3,3,2,3,3,3,3,3,0,0],
        [0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,3,3,3,3,3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3,3,3,3,3,0,0,0],
        [0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,4,4,4,3,3,3,3,3,3,3,3,3,4,4,3,3,3,3,3,3,3,3,3,3,3,3,0,0,0],
        [0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,3,3,3,3,3,3,3,3,0,0,4,3,3,3,3,3,3,3,3,3,3,0,3,3,0,0],
        [0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,4,4,4,0,0,0,4,4,4,3,3,3,3,3,0,0,0,0,0,0,3,3,0,3,3,3,3,0,0,0,0,3,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
    ];

//    Small test map
//    map.setSize(10, 10);
//    map.map = [
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,1,1,1,0,0,0],
//        [0,0,0,0,1,1,1,0,0,0],
//        [0,0,0,0,1,1,1,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0],
//        [0,0,0,0,0,0,0,0,0,0]
//    ];

    var agents = [
        initAgent("Straight"),
        initAgent("Foxel"),
        initAgent("Foxel"),
        initAgent("Foxel"),
        initAgent("Foxel"),
        initAgent("Foxel"),
        initAgent("Foxel"),
        initAgent("DummyAgent"),
        initAgent("VeryDummy"),
        initAgent("ReAgent")
    ];

    var srv = new serverModule.Server(agents, map);
    srv.run();
    var observerModule = require('./WebObserver');
    var observer = new observerModule.WebObserver(srv, 8090);
    observer.run();
})();
